<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="threadMapper">

   <resultMap type="Chat" id="chat_rm">
      <id property="chatNo" column="CHAT_NO"/>
      <result property="threadNo" column="THREAD_NO"/>
      <result property="chatMessage" column="CHAT_CONTENT"/>
      <result property="chatCreateDate" column="C_CREATE_DATE"/>
      <result property="chatUpdateDAte" column="C_UPDATE_DATE"/>
      
      <result property="memberNo" column="MEMBER_NO"/>
      <result property="memberNickname" column="MEMBER_NICKNAME"/>
      <result property="profileImage" column="PROFILE_IMG"/>
      
      <collection property="fileList"
               select="selectFileList"
               column="CHAT_NO"
               javaType="java.util.ArrayList"
               ofType="ChatFile">
      </collection>
      
      <collection property="commentList"
               select="selectCommentList"
               column="CHAT_NO"
               javaType="java.util.ArrayList"
               ofType="ChatComment">
      </collection>
   </resultMap>
   
   <resultMap type="ThreadInfo" id="threadInfo_rm">
   		<id property="threadNo" column="THREAD_NO"/>
   		<result property="projectNo" column="PROJECT_NO"/>
   		<result property="threadTitle" column="THREAD_TITLE"/>
   		
   		<collection property="userList"
   					select="selectUserList"
   					column="THREAD_NO"
   					javaType="java.util.ArrayList"
   					ofType="User">
		</collection>
   </resultMap>
   
   <resultMap type="ThreadFile" id="threadFile_rm">
   		<id property="fileNo" column="FILE_NO"/>
   		<result property="filePath" column="FILE_PATH"/>
   		<result property="fileRename" column="FILE_RENAME"/>
   		<result property="fileOriginal" column="FILE_ORIGINAL"/>
   		<result property="fileOrder" column="FILE_ORDER"/>
   		<result property="fileCode" column="FILE_CODE"/>
   		<result property="targetNo" column="TRAGET_NO"/>
   
   </resultMap>
   
   <select id="selectFileList" resultMap="threadFile_rm">
      SELECT * FROM FILES
      WHERE TRAGET_NO=#{targetNo}
      AND FILE_CODE = 2
   </select>
   
   <select id="selectMemberList" resultType="map">
      SELECT USER_NO, USER_EMAIL, USER_NAME, PROFILE_IMG
      FROM USER
      JOIN USER_PROJECT(USER_NO)
      WHERE PROJECT_NO = #{projectNo}
      AND USER_NAME LIKE '%${query}%'
   </select>
   
   <select id="selectThread" resultMap="threadInfo_rm">
      SELECT THREAD_NO, THREAD_TITLE
      FROM THREAD
      JOIN PROJECT_THREAD USING(THREAD_NO)
      WHERE PROJECT_NO = #{projectNo}
   </select>
   
</mapper>
